{% extends "admin_portal/base.html" %}

{% block title %}Clientes{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Clientes</h1>
    <p class="page-subtitle">Gerencie sua base de clientes</p>
</div>

<!-- Search and Filters -->
<div class="card" style="margin-bottom: var(--space-lg);">
    <form method="GET" style="display: flex; gap: var(--space-md); align-items: end;">
        <div style="flex: 1;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Buscar</label>
            <input type="text" name="search" value="{{ search_query }}" placeholder="Nome ou email..."
                style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-gray-light); border-radius: 8px;">
        </div>
        <div style="min-width: 200px;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Tipo</label>
            <select name="type"
                style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-gray-light); border-radius: 8px;">
                <option value="">Todos</option>
                <option value="PF" {% if client_type == 'PF' %}selected{% endif %}>Pessoa Física</option>
                <option value="PJ" {% if client_type == 'PJ' %}selected{% endif %}>Pessoa Jurídica</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Buscar</button>
        <a href="{% url 'admin_portal:client_create' %}" class="btn btn-primary">+ Novo Cliente</a>
    </form>
</div>

<!-- Clients Table -->
<div class="card">
    <h2 class="card-title">{{ clients.count }} Cliente{{ clients.count|pluralize }}</h2>

    {% if clients %}
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 2px solid var(--color-gray-light);">
                <th style="padding: 1rem; text-align: left;">Nome</th>
                <th style="padding: 1rem; text-align: left;">Tipo</th>
                <th style="padding: 1rem; text-align: left;">Contato</th>
                <th style="padding: 1rem; text-align: left;">Casos</th>
                <th style="padding: 1rem; text-align: left;">Cadastro</th>
                <th style="padding: 1rem; text-align: left;">Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for client in clients %}
            <tr style="border-bottom: 1px solid var(--color-gray-light);">
                <td style="padding: 1rem;">
                    <strong>{{ client.full_name }}</strong>
                </td>
                <td style="padding: 1rem;">
                    <span
                        style="background: var(--color-creme); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">
                        {{ client.get_client_type_display }}
                    </span>
                </td>
                <td style="padding: 1rem;">
                    <div style="font-size: 0.9rem; color: var(--color-gray-dark);">
                        {{ client.email|default:"-" }}
                    </div>
                </td>
                <td style="padding: 1rem;">
                    {{ client.cases.count }} caso{{ client.cases.count|pluralize }}
                </td>
                <td style="padding: 1rem; font-size: 0.9rem; color: var(--color-gray);">
                    {{ client.created_at|date:"d/m/Y" }}
                </td>
                <td style="padding: 1rem;">
                    <a href="{% url 'admin_portal:client_detail' client.id %}" class="btn btn-secondary"
                        style="font-size: 0.85rem; padding: 0.5rem 1rem;">
                        Ver Perfil
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; padding: 3rem; color: var(--color-gray);">
        Nenhum cliente encontrado.
    </p>
    {% endif %}
</div>
{% endblock %}