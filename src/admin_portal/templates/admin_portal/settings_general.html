{% extends "admin_portal/base.html" %}

{% block title %}Configurações & Integrações{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Configurações do Sistema</h1>
    <p class="page-subtitle">Gerencie as conexões externas e parâmetros operacionais do escritório.</p>
</div>

{% if messages %}
{% for message in messages %}
<div class="card"
    style="background: #f0fdf4; border-left: 4px solid #166534; padding: 1rem; margin-bottom: 2rem; color: #166534;">
    {{ message }}
</div>
{% endfor %}
{% endif %}

<form method="POST">
    {% csrf_token %}
    <div style="display: grid; gap: var(--space-lg); grid-template-columns: 2fr 1fr;">
        <!-- Principal -->
        <div style="display: grid; gap: var(--space-lg);">
            <div class="card">
                <h3 style="margin-bottom: var(--space-md); font-family: 'Playfair Display', serif;">Integrações Ativas
                </h3>
                <div style="display: grid; gap: var(--space-md);">
                    {% for integration in integrations %}
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; padding: 1.25rem; background: var(--color-creme); border-radius: 12px; border: 1px solid var(--color-gray-light);">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div
                                style="width: 40px; height: 40px; background: var(--color-black); color: var(--color-creme); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                {{ integration.name|slice:":1" }}
                            </div>
                            <div>
                                <strong>{{ integration.name }}</strong>
                                <div style="font-size: 0.8rem; color: var(--color-gray);">Status:
                                    <span
                                        class="{% if integration.enabled %}status-connected{% else %}status-pending{% endif %}"
                                        style="padding: 2px 8px; border-radius: 10px; font-weight: 600;">
                                        {{ integration.status }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <label style="position: relative; display: inline-block; width: 50px; height: 26px;">
                            <input type="checkbox"
                                name="{% if 'WhatsApp' in integration.name %}whatsapp_enabled{% elif 'Clio' in integration.name %}clio_integration_active{% elif 'Jestor' in integration.name %}jestor_integration_active{% endif %}"
                                {% if integration.enabled %}checked{% endif %} style="opacity: 0; width: 0; height: 0;">
                            <span
                                style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px;">
                                <span
                                    style="position: absolute; content: ''; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                            </span>
                        </label>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: var(--space-md); font-family: 'Playfair Display', serif;">Identidade do
                    Escritório</h3>
                <div style="margin-bottom: 1.5rem;">
                    <label for="office_name" style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Nome de
                        Exibição</label>
                    <input type="text" id="office_name" name="office_name" value="{{ settings.office_name }}"
                        style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-gray-light); border-radius: 8px; font-family: inherit;">
                </div>
                <button type="submit" class="btn btn-primary">Salvar Todas as Configurações</button>
            </div>
        </div>

        <!-- Sidebar Config -->
        <div style="display: grid; gap: var(--space-lg);">
            <div class="card">
                <h3 style="margin-bottom: var(--space-md); font-family: 'Playfair Display', serif;">Portal do Cliente
                </h3>
                <p style="color: var(--color-gray); margin-bottom: 1.5rem; font-size: 0.9rem;">Configure como os
                    clientes interagem com a plataforma.</p>

                <div style="display: grid; gap: 1.5rem;">
                    <div>
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <strong>Notificações Auto</strong>
                            <label style="position: relative; display: inline-block; width: 40px; height: 22px;">
                                <input type="checkbox" name="client_notification_auto" {% if settings.client_notification_auto %}checked{% endif %}
                                    style="opacity: 0; width: 0; height: 0;">
                                <span
                                    style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px;">
                                    <span
                                        style="position: absolute; content: ''; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                                </span>
                            </label>
                        </div>
                        <div style="font-size: 0.8rem; color: var(--color-gray);">Enviar WhatsApp automático em
                            atualizações.</div>
                    </div>

                    <hr style="border: 0; border-top: 1px solid #eee;">

                    <div>
                        <label for="token_validity_days"
                            style="display: block; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.9rem;">Validade
                            do Token (dias)</label>
                        <select id="token_validity_days" name="token_validity_days"
                            style="width: 100%; padding: 0.5rem; border-radius: 8px; border: 1px solid var(--color-gray-light);">
                            <option value="30" {% if settings.token_validity_days == 30 %}selected{% endif %}>30 dias
                            </option>
                            <option value="90" {% if settings.token_validity_days == 90 %}selected{% endif %}>90 dias
                            </option>
                            <option value="365" {% if settings.token_validity_days == 365 %}selected{% endif %}>1 ano
                            </option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="card" style="background: var(--color-black); color: var(--color-creme);">
                <h4 style="color: var(--color-salmon); margin-bottom: 1rem;">Status dos Robôs</h4>
                <div style="display: grid; gap: 0.75rem;">
                    <div style="display: flex; justify-content: space-between; font-size: 0.85rem;">
                        <span>Intake Bot</span>
                        <span style="color: #4ade80;">● Online</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.85rem;">
                        <span>Sync Timeline</span>
                        <span style="color: #facc15;">● Em pausa</span>
                    </div>
                    <button type="button" class="btn btn-secondary"
                        style="width: 100%; font-size: 0.8rem; margin-top: 0.5rem; background: #333; color: white;">Ações
                        do Desenvolvedor</button>
                </div>
            </div>
        </div>
    </div>
</form>

<style>
    input:checked+span {
        background-color: var(--color-salmon) !important;
    }

    input:checked+span span {
        transform: translateX(24px) !important;
    }

    /* Para o toggle menor na sidebar */
    div:has(> label > input[name="client_notification_auto"]:checked) label span span {
        transform: translateX(18px) !important;
    }
</style>
{% endblock %}
