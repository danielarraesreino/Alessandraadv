{% extends 'admin_portal/base.html' %}

{% block title %}{% if article %}Editar: {{ article.title }}{% else %}Novo Artigo{% endif %} - In Brief{% endblock %}

{% block extra_css %}
{{ form.media }}
<style>
    .django-ckeditor-widget {
        width: 100% !important;
    }

    .ck-editor__editable {
        min-height: 450px;
    }

    .form-group {
        margin-bottom: 2rem;
    }

    .form-label {
        display: block;
        font-weight: 700;
        margin-bottom: 0.75rem;
        color: var(--color-black);
    }

    .help-text {
        font-size: 0.85rem;
        color: var(--color-gray);
        margin-top: 0.5rem;
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1 class="page-title">{% if article %}Editar Artigo{% else %}Novo Artigo{% endif %}</h1>
            <p class="page-subtitle">{% if article %}Ajuste os detalhes do seu conteúdo jurídico.{% else %}Comece a
                escrever sua nova publicação.{% endif %}</p>
        </div>
        <a href="{% url 'admin_portal:article_list' %}" class="btn btn-secondary">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
            </svg>
            Voltar
        </a>
    </div>
</div>

<form method="POST">
    {% csrf_token %}

    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
        <!-- Coluna Principal (Escrita) -->
        <div>
            <div class="card">
                <div class="form-group">
                    <label class="form-label" for="{{ form.title.id_for_label }}">Título do Artigo</label>
                    {{ form.title }}
                    {% if form.title.errors %}<p
                        style="color: var(--color-danger); font-size: 0.85rem; margin-top: 0.5rem;">{{
                        form.title.errors.0 }}</p>{% endif %}
                </div>

                <div class="form-group">
                    <label class="form-label" for="{{ form.content.id_for_label }}">Conteúdo Principal</label>
                    {{ form.content }}
                    {% if form.content.errors %}<p
                        style="color: var(--color-danger); font-size: 0.85rem; margin-top: 0.5rem;">{{
                        form.content.errors.0 }}</p>{% endif %}
                </div>
            </div>
        </div>

        <!-- Coluna Lateral (Configurações) -->
        <div>
            <div class="card">
                <h3 class="card-title">Configurações</h3>

                <div class="form-group">
                    <label class="form-label" for="{{ form.categories.id_for_label }}">Categorias</label>
                    {{ form.categories }}
                    <span class="help-text">Mantenha Ctrl/Cmd pressionado para múltiplas.</span>
                </div>

                <div class="form-group">
                    <label class="form-label" for="{{ form.summary.id_for_label }}">Resumo Curto</label>
                    {{ form.summary }}
                    <span class="help-text">Aparece na página inicial e prévias.</span>
                </div>

                <div class="form-group" style="padding: 1rem; background: var(--color-creme); border-radius: 8px;">
                    <label style="display: flex; align-items: center; cursor: pointer; gap: 0.75rem;">
                        {{ form.is_published }}
                        <span style="font-weight: 700;">Publicar Agora</span>
                    </label>
                    <span class="help-text" style="margin-left: 2rem;">Se desmarcado, ficará como Rascunho.</span>
                </div>

                <div style="display: flex; flex-direction: column; gap: 1rem; margin-top: 2rem;">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                            <path
                                d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z" />
                        </svg>
                        Salvar Alterações
                    </button>
                    <a href="{% url 'admin_portal:article_list' %}" class="btn btn-secondary"
                        style="width: 100%;">Cancelar</a>
                </div>
            </div>

            {% if article %}
            <div class="card" style="background: var(--color-black); color: white;">
                <h4 style="margin-bottom: 1rem; color: var(--color-salmon);">Info do Artigo</h4>
                <p style="font-size: 0.85rem; margin-bottom: 0.5rem; opacity: 0.8;">Criado em: {{
                    article.created_at|date:"d/m/Y H:i" }}</p>
                <p style="font-size: 0.85rem; opacity: 0.8;">Última edição: {{ article.updated_at|date:"d/m/Y H:i" }}
                </p>
            </div>
            {% endif %}
        </div>
    </div>
</form>
{% endblock %}